<!-- index.html - Jinja template -->

<!DOCTYPE html>
<html lang="sl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Robot â€“ Kognitivni Trening</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <!-- Google Fonts - Lexend za lepÅ¡o tipografijo -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>
<body>
    <div id="container">
        <!-- LEVI DEL - CHAT OKNO -->
        <div id="chat-panel">
            <div id="chat-header">
                <div class="header-icon">ğŸ¤–</div>
                <div class="header-text">
                    <h1>Robot â€“ Kognitivni Trening</h1>
                    <span class="header-subtitle">Interaktivna simulacija</span>
                </div>
                <!-- Povezava do evalvacije -->
                <a href="/evaluate" class="eval-link" title="Evalvacija">ğŸ“Š</a>
            </div>
            
            <!-- FSM DIAGRAM -->
            <div id="fsm-diagram">
                <div class="fsm-state {{ 'active' if current_state == 'S0_GREETING' else '' }}" data-state="S0_GREETING">
                    <span class="state-icon">ğŸ‘‹</span>
                    <span class="state-name">Pozdrav</span>
                </div>
                <div class="fsm-arrow">â†’</div>
                <div class="fsm-state {{ 'active' if current_state == 'S1_EXPLANATION' else '' }}" data-state="S1_EXPLANATION">
                    <span class="state-icon">ğŸ“–</span>
                    <span class="state-name">Razlaga</span>
                </div>
                <div class="fsm-arrow">â†’</div>
                <div class="fsm-state {{ 'active' if current_state == 'S2_EXERCISE' else '' }}" data-state="S2_EXERCISE">
                    <span class="state-icon">ğŸ¯</span>
                    <span class="state-name">Vaja</span>
                </div>
                <div class="fsm-arrow-down">â†“</div>
                <div class="fsm-state {{ 'active' if current_state == 'S3_BREAK' else '' }}" data-state="S3_BREAK">
                    <span class="state-icon">â˜•</span>
                    <span class="state-name">Odmor</span>
                </div>
                <div class="fsm-arrow">â†’</div>
                <div class="fsm-state final {{ 'active' if current_state == 'S4_FEEDBACK' else '' }}" data-state="S4_FEEDBACK">
                    <span class="state-icon">âœ…</span>
                    <span class="state-name">ZakljuÄek</span>
                </div>
            </div>
            
            <div id="chat-box">
                {% for message in conversation %}
                <div class="message {{ message.sender }}-message {% if message.get('type') %}{{ message.type }}-type{% endif %}">
                    <div class="message-bubble">{{ message.text }}</div>
                </div>
                {% endfor %}
            </div>
            
            <!-- STATISTIKA SEJE -->
            <div id="session-stats">
                <div class="stat-item positive">
                    <span class="stat-icon">ğŸ˜Š</span>
                    <span class="stat-value" id="stat-positive">{{ statistics.positive_interactions }}</span>
                    <span class="stat-label">Pozitivnih</span>
                </div>
                <div class="stat-item negative">
                    <span class="stat-icon">ğŸ˜Ÿ</span>
                    <span class="stat-value" id="stat-negative">{{ statistics.negative_interactions }}</span>
                    <span class="stat-label">Negativnih</span>
                </div>
                <div class="stat-item escalation">
                    <span class="stat-icon">âš ï¸</span>
                    <span class="stat-value" id="stat-escalation">{{ statistics.total_escalations }}</span>
                    <span class="stat-label">Eskalacij</span>
                </div>
                <div class="stat-item steps">
                    <span class="stat-icon">ğŸ‘£</span>
                    <span class="stat-value" id="stat-steps">{{ statistics.step_count }}</span>
                    <span class="stat-label">Korakov</span>
                </div>
                <div class="stat-item success">
                    <span class="stat-icon">ğŸ¯</span>
                    <span class="stat-value" id="stat-success">{{ statistics.success_steps }}/5</span>
                    <span class="stat-label">UspeÅ¡nih</span>
                </div>
            </div>
        </div>
        
        <!-- DESNI DEL - TRIGGER PANEL -->
        <div id="trigger-panel">
            <h3>Simuliraj Trigger</h3>
            <p class="trigger-hint">Kliknite na trigger za simulacijo uporabnikovega vedenja</p>
            
            <!-- TRENUTNO STANJE -->
            <div id="current-state-display" class="state-{{ state_info.color }}">
                <span class="state-display-icon">{{ state_info.icon }}</span>
                <div class="state-display-text">
                    <span class="state-display-label">Trenutno stanje:</span>
                    <span class="state-display-name" id="current-state-name">{{ state_info.name }}</span>
                </div>
            </div>
            
            <!-- POZITIVNI TRIGGERJI -->
            <div class="trigger-group positive">
                <h4>âœ¨ Pozitivni signali</h4>
                {% if triggers.positive %}
                    {% for trigger in triggers.positive %}
                    <button class="trigger-btn positive-btn" onclick="sendTrigger('{{ trigger }}')">
                        {{ trigger }}
                    </button>
                    {% endfor %}
                {% else %}
                    <button class="trigger-btn positive-btn" onclick="sendTrigger('User smiles / laughs')">User smiles / laughs</button>
                    <button class="trigger-btn positive-btn" onclick="sendTrigger('Positive affect')">Positive affect</button>
                {% endif %}
            </div>
            
            <!-- NEVTRALNI TRIGGERJI -->
            <div class="trigger-group neutral">
                <h4>â¸ï¸ Nevtralni signali</h4>
                {% if triggers.neutral %}
                    {% for trigger in triggers.neutral %}
                    <button class="trigger-btn neutral-btn" onclick="sendTrigger('{{ trigger }}')">
                        {{ trigger }}
                    </button>
                    {% endfor %}
                {% else %}
                    <button class="trigger-btn neutral-btn" onclick="sendTrigger('Long silence')">Long silence</button>
                    <button class="trigger-btn neutral-btn" onclick="sendTrigger('User confused / waiting')">User confused / waiting</button>
                {% endif %}
            </div>
            
            <!-- NEGATIVNI TRIGGERJI -->
            <div class="trigger-group negative">
                <h4>âš ï¸ Negativni signali</h4>
                {% if triggers.negative %}
                    {% for trigger in triggers.negative %}
                    <button class="trigger-btn negative-btn" onclick="sendTrigger('{{ trigger }}')">
                        {{ trigger }}
                    </button>
                    {% endfor %}
                {% else %}
                    <button class="trigger-btn negative-btn" onclick="sendTrigger('User frustrated / overloaded')">User frustrated / overloaded</button>
                    <button class="trigger-btn negative-btn" onclick="sendTrigger('User decreasing engagement')">User decreasing engagement</button>
                {% endif %}
            </div>
            
            <!-- ZAKLJUÄŒNI TRIGGERJI -->
            <div class="trigger-group final">
                <h4>ğŸ ZakljuÄni signali</h4>
                {% if triggers.final %}
                    {% for trigger in triggers.final %}
                    <button class="trigger-btn final-btn" onclick="sendTrigger('{{ trigger }}')">
                        {{ trigger }}
                    </button>
                    {% endfor %}
                {% else %}
                    <button class="trigger-btn final-btn" onclick="sendTrigger('end of user speech')">end of user speech</button>
                    <button class="trigger-btn final-btn" onclick="sendTrigger('end of user movement')">end of user movement</button>
                {% endif %}
            </div>
            
            <!-- KONTROLNI GUMBI -->
            <div class="control-buttons">
                <button id="force-end-btn" onclick="forceEnd()" class="control-btn end-btn">
                    ğŸ›‘ ZakljuÄi sejo
                </button>
                <button id="reset-session" onclick="resetSession()" class="control-btn reset-btn">
                    ğŸ”„ Nova seja
                </button>
            </div>
        </div>
    </div>
    
    <!-- Notification za END stanje z evalvacijo -->
    <div id="end-notification" class="hidden">
        <div class="notification-content evaluation-modal">
            <h3>ğŸ‰ Seja zakljuÄena</h3>
            <p id="end-reason-text">Trening je bil uspeÅ¡no zakljuÄen.</p>
            
            <div id="final-stats">
                <div class="final-stat">
                    <span class="final-stat-label">Koraki:</span>
                    <span class="final-stat-value" id="final-steps">0</span>
                </div>
                <div class="final-stat">
                    <span class="final-stat-label">Pozitivnih:</span>
                    <span class="final-stat-value" id="final-positive">0</span>
                </div>
                <div class="final-stat">
                    <span class="final-stat-label">Eskalacij:</span>
                    <span class="final-stat-value" id="final-escalation">0</span>
                </div>
            </div>
            
            <!-- Evalvacija uporabnika -->
            <div id="evaluation-section">
                <h4>â­ Oceni interakcijo z robotom</h4>
                
                <div class="eval-question">
                    <label>Robot se mi zdi <strong>podporen</strong></label>
                    <div class="star-rating" data-question="supportive">
                        <span class="star" data-value="1">â˜†</span>
                        <span class="star" data-value="2">â˜†</span>
                        <span class="star" data-value="3">â˜†</span>
                        <span class="star" data-value="4">â˜†</span>
                        <span class="star" data-value="5">â˜†</span>
                    </div>
                </div>
                
                <div class="eval-question">
                    <label>Robot se mi zdi <strong>razumljiv</strong></label>
                    <div class="star-rating" data-question="understandable">
                        <span class="star" data-value="1">â˜†</span>
                        <span class="star" data-value="2">â˜†</span>
                        <span class="star" data-value="3">â˜†</span>
                        <span class="star" data-value="4">â˜†</span>
                        <span class="star" data-value="5">â˜†</span>
                    </div>
                </div>
                
                <div class="eval-question">
                    <label>Robot se mi zdi <strong>nevsiljiv</strong></label>
                    <div class="star-rating" data-question="non_intrusive">
                        <span class="star" data-value="1">â˜†</span>
                        <span class="star" data-value="2">â˜†</span>
                        <span class="star" data-value="3">â˜†</span>
                        <span class="star" data-value="4">â˜†</span>
                        <span class="star" data-value="5">â˜†</span>
                    </div>
                </div>
            </div>
            
            <div class="modal-buttons">
                <button onclick="submitEvaluation()" id="submit-eval-btn" class="btn-primary">
                    Oddaj oceno in zaÄni novo sejo
                </button>
                <button onclick="skipEvaluation()" class="btn-secondary">
                    PreskoÄi
                </button>
            </div>
        </div>
    </div>
    
    <!-- Notification za predlog zakljuÄka -->
    <div id="suggest-end-notification" class="hidden">
        <div class="notification-content warning">
            <h3>âš ï¸ PreveÄ teÅ¾av</h3>
            <p>Robot je zaznal veÄ teÅ¾av. Å½eliÅ¡ zakljuÄiti ali nadaljevati?</p>
            <div class="notification-buttons">
                <button onclick="forceEnd()" class="btn-end">ZakljuÄi</button>
                <button onclick="hideSuggestEnd()" class="btn-continue">Nadaljuj</button>
            </div>
        </div>
    </div>
    
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
